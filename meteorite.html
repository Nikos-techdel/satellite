<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Meteorite Simulation - Visible & Fixed</title>
<style>
body { background: #eef; font-family: Arial, sans-serif; text-align:center; }
canvas { background:white; border:2px solid #333; cursor:crosshair; }
.controls { background:#dde; width:580px; margin:10px auto; padding:10px; border-radius:10px; }
label { font-weight:bold; }
button, input[type=checkbox] { font-size:14px; margin:5px; padding:4px 10px; }
.energy-bar { display:inline-block; width:20px; height:100px; background:#ccc; margin:0 5px; vertical-align:bottom; position:relative; }
.energy-fill { position:absolute; bottom:0; width:100%; }
</style>
</head>
<body>

<h2>Meteorite Approaching Earth</h2>
<p>Drag the meteor to a start position, press <b>Start</b>. Use Slow Motion, Pause, Reset. Click meteor to reset to hint.</p>

<canvas id="canvas" width="500" height="500"></canvas>

<div class="controls">
  <div>
    <label>Sideways Speed</label><br>
    Slow
    <input type="range" id="speed" min="0" max="4.5" step="0.1" value="2">
    Fast
  </div>

  <div>
    <button id="startBtn">Start</button>
    <button id="pauseBtn">Pause / Resume</button>
    <button id="slowBtn">Slow Motion OFF</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div>
    <input type="checkbox" id="showVectors" checked>
    <label for="showVectors">Show Vectors</label>
    <input type="checkbox" id="showTrail" checked>
    <label for="showTrail">Show Trail</label>
  </div>
</div>

<h3>Energy (scaled units)</h3>
<div style="width:180px; margin:auto;">
  <div class="energy-bar"><div class="energy-fill" id="ke" style="background:orange;height:0%"></div><div style="position:absolute;top:-20px;width:100%;text-align:center;font-size:12px;">KE</div></div>
  <div class="energy-bar"><div class="energy-fill" id="pe" style="background:blue;height:0%"></div><div style="position:absolute;top:-20px;width:100%;text-align:center;font-size:12px;">PE</div></div>
  <div class="energy-bar"><div class="energy-fill" id="te" style="background:green;height:0%"></div><div style="position:absolute;top:-20px;width:100%;text-align:center;font-size:12px;">Total</div></div>
</div>

<script>
window.onload = function(){
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const speedSlider = document.getElementById("speed");
  const startBtn = document.getElementById("startBtn");
  const pauseBtn = document.getElementById("pauseBtn");
  const slowBtn = document.getElementById("slowBtn");
  const resetBtn = document.getElementById("resetBtn");
  const showVectors = document.getElementById("showVectors");
  const showTrail = document.getElementById("showTrail");

  const earth = { x:250, y:250, r:45 };
  let meteor = {x:250, y:50, vx:2, vy:0, mass:1}; // ensure visible
  let running=false, paused=false, slowMotion=false, trail=[];
  let dragging=false, showHint=true;
  const hint = {x:250, y:50, r:12}; // visible

  function resetMeteorPosition(){
    meteor.x = hint.x;
    meteor.y = hint.y;
    meteor.vx = Number(speedSlider.value);
    meteor.vy = 0;
    meteor.mass = 1;
    trail=[];
    showHint=true;
  }

  function reset(){
    resetMeteorPosition();
    running=false;
    paused=false;
    slowMotion=false;
    slowBtn.textContent="Slow Motion OFF";
    draw();
    updateEnergyBars();
  }

  function start(){
    running=true;
    paused=false;
    meteor.vx = Number(speedSlider.value);
    meteor.vy = 0;
    showHint=false;
  }

  function pause(){ if(running) paused = !paused; }

  function toggleSlow(){
    slowMotion=!slowMotion;
    slowBtn.textContent = slowMotion?"Slow Motion ON":"Slow Motion OFF";
  }

  canvas.addEventListener('mousedown', e=>{
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    const dist = Math.hypot(mx-meteor.x, my-meteor.y);

    if(!running && dist<10){ dragging=true; showHint=false; }
    if(dist<6){ resetMeteorPosition(); }
  });

  canvas.addEventListener('mousemove', e=>{ if(dragging){ const rect=canvas.getBoundingClientRect(); meteor.x=e.clientX-rect.left; meteor.y=e.clientY-rect.top; draw(); } });
  canvas.addEventListener('mouseup', e=>dragging=false);
  canvas.addEventListener('mouseleave', e=>dragging=false);

  function update(){
    if(!running||paused) return;
    const dt = slowMotion?0.1:1;
    const dx = earth.x-meteor.x, dy = earth.y-meteor.y, dist = Math.sqrt(dx*dx+dy*dy);
    const g=0.15, ax = g*dx/dist, ay=g*dy/dist;
    meteor.vx += ax*dt; meteor.vy += ay*dt;
    meteor.x += meteor.vx*dt; meteor.y += meteor.vy*dt;

    if(showTrail.checked){ trail.push({x:meteor.x,y:meteor.y}); if(trail.length>150) trail.shift(); } else trail=[];
    if(dist<earth.r) running=false;
    updateEnergyBars();
  }

  function updateEnergyBars(){
    const ke=0.5*meteor.mass*(meteor.vx**2+meteor.vy**2);
    const pe=meteor.mass*0.15*Math.sqrt((meteor.x-earth.x)**2+(meteor.y-earth.y)**2);
    const te=ke+pe; const maxE=20;
    document.getElementById("ke").style.height=Math.min(ke/maxE*100,100)+'%';
    document.getElementById("pe").style.height=Math.min(pe/maxE*100,100)+'%';
    document.getElementById("te").style.height=Math.min(te/maxE*100,100)+'%';
  }

  function drawArrow(x,y,dx,dy,color){
    ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x+dx,y+dy); ctx.strokeStyle=color; ctx.lineWidth=2; ctx.stroke();
    const angle=Math.atan2(dy,dx),len=8; ctx.beginPath();
    ctx.moveTo(x+dx,y+dy); ctx.lineTo(x+dx-len*Math.cos(angle-Math.PI/6),y+dy-len*Math.sin(angle-Math.PI/6));
    ctx.lineTo(x+dx-len*Math.cos(angle+Math.PI/6),y+dy-len*Math.sin(angle+Math.PI/6)); ctx.lineTo(x+dx,y+dy); ctx.fillStyle=color; ctx.fill();
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(showTrail.checked && trail.length>1){ ctx.beginPath(); for(let p of trail) ctx.lineTo(p.x,p.y); ctx.strokeStyle="orange"; ctx.lineWidth=2; ctx.stroke(); }
    ctx.beginPath(); ctx.arc(earth.x,earth.y,earth.r,0,Math.PI*2); ctx.fillStyle="#3a7bd5"; ctx.fill();
    ctx.beginPath(); ctx.arc(meteor.x,meteor.y,6,0,Math.PI*2); ctx.fillStyle="orange"; ctx.fill();
    if(showHint){ ctx.beginPath(); ctx.arc(hint.x,hint.y,hint.r,0,Math.PI*2); ctx.fillStyle="rgba(255,165,0,0.4)"; ctx.fill(); }
    if(showVectors.checked){ drawArrow(meteor.x,meteor.y,meteor.vx*5,meteor.vy*5,"red"); const dx=earth.x-meteor.x, dy=earth.y-meteor.y, dist=Math.sqrt(dx*dx+dy*dy); drawArrow(meteor.x,meteor.y,5*0.15*dx/dist,5*0.15*dy/dist,"blue"); }
  }

  function loop(){ update(); draw(); requestAnimationFrame(loop); }

  startBtn.onclick=start;
  pauseBtn.onclick=pause;
  resetBtn.onclick=reset;
  slowBtn.onclick=toggleSlow;

  reset();
  loop();
};
</script>
</body>
</html>

